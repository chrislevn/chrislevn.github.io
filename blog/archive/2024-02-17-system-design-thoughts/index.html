<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>System design thoughts on building a low-cost scalable backend | Christopher Loc Le</title> <meta name="author" content="Christopher Loc Le"> <meta name="description" content="A software engineer with a passion for connecting all things infrastructure and data. "> <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.22.1/dist/bootstrap-table.min.css"> <link rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?19f3075a2d19613090fe9e16b564e1fe" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="/assets/img/prof_pic.jpg?d19ea9a3c704eb5ced8d00c2a64bb308"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://christopherle.com//blog/archive/2024-02-17-system-design-thoughts/"> <link rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?e74e74bf055e5729d44a7d031a5ca6a5" media="none" id="highlight_theme_dark"> <script src="/assets/js/theme.js?96d6b3e1c3604aca8b6134c7afdd5db6"></script> <script src="/assets/js/dark_mode.js?9b17307bb950ffa2e34be0227f53558f"></script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"><span class="font-weight-bold">Christopher </span>Loc Le</a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about</a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">blog<span class="sr-only">(current)</span></a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">publications</a> </li> <li class="nav-item "> <a class="nav-link" href="/projects/">projects</a> </li> <li class="nav-item"> <a class="nav-link" href="/assets/pdf/christopher_resume_swe.pdf" target="_blank" rel="noopener noreferrer">resume</a> </li> <li class="nav-item"> <a class="nav-link" href="https://substack.com/@christopherle?utm_source=edit-profile-page" target="_blank" rel="noopener noreferrer">archive</a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fas fa-moon"></i> <i class="fas fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5"> <div class="post"> <header class="post-header"> <h1 class="post-title">System design thoughts on building a low-cost scalable backend</h1> <p class="post-meta">February 17, 2024</p> <p class="post-tags"> <a href="/blog/2024"> <i class="fas fa-calendar fa-sm"></i> 2024 </a>   ·   <a href="/blog/tag/languages-python-algorithms-backend"> <i class="fas fa-hashtag fa-sm"></i> languages python algorithms backend</a>     ·   <a href="/blog/category/backend"> <i class="fas fa-tag fa-sm"></i> backend</a>   </p> </header> <article class="post-content"> <div id="markdown-content"> <p>If you haven’t, check out my previous post on <a href="https://christopherle.com/blog/2024/thought-process-project/">My thought process of building end-to-end low-cost backend</a>. Today’s post will go more in depth on the system design aspect of building a low-cost scalable backend.</p> <p>This post comes from real experience as I already built this backend. I also learned what works and what doesn’t work for me. FYI, I’m not a system design expert. I am a junior software engineer who is eager to learn and share my thoughts.</p> <p>But if I have to approach this in a system design interview, here’s how I would do it:</p> <ol> <li>Understand the requirements</li> <li>Back of the envelope estimation</li> <li>High-level design</li> <li>Detailed design</li> </ol> <h2 id="understand-the-requirements">Understand the requirements</h2> <h3 id="functional-requirements">Functional requirements</h3> <p>Functional requirements are what are the functionalities that the system should provide. For my backend for example, I need to be able to:</p> <ul> <li>Send emails to subscribed users a new challenge every week.</li> </ul> <p>This is the big question given from the interviewer/manager. How can we break this down into smaller pieces? Go from WHO to HOW</p> <ul> <li>Who are the users? Users who bought the product and subscribed to the weekly challenge email.</li> <li>How the users will use this system? This comes with smaller questions: <ul> <li>How do users subscribe to the weekly challenge email? -&gt; assumption in this case Shopify already have this a product and we can retrive the list of subscribed users from Shopify API.</li> <li>How do we send the weekly challenge email? -&gt; In this case, I use AWS SES with Github Actions as cron jobs since they are more cost-effective.</li> <li>How do we know what challenge to send to what users? -&gt; In this case, I will confirm with the interviwer/manager. Assume that we will have a list of various challenges of different levels. We also need to determine user’s level.</li> <li>Okay, how do we determine user’s level? -&gt; We need to send users an inital questionaire to determine their level.</li> <li>Ask again, if user did their challenge, how do we know? -&gt; We need to have a server to interact with the backend.</li> <li>If user passed the challenge, how do we update their level?</li> <li>Can users see their level for progression?</li> </ul> </li> </ul> <p>That said, here is what I got:</p> <ul> <li>We need to have a cron job that run a script to send the weekly challenge email to the subscribed users.</li> <li> <p>We need a server for users to interact with the backend. Here are the possible functions and API endpoints users might have:</p> <ul> <li>Update user’s level from the questionaire -&gt; POST /questionaire?passed=true&amp;user_id={user_id}</li> <li>User see the challenge -&gt; GET /challenges/{challenge_id}?user_id={user_id}</li> <li>User submit the challenge -&gt; POST /challenges/{challenge_id}?user_id={user_id}&amp;submission=true</li> <li>User see their level -&gt; GET /level?user_id={user_id}</li> </ul> </li> </ul> <h3 id="non-functional-requirements">Non-functional requirements</h3> <p>Non-functional requirements are the constraints that the system should satisfy. There are several non-functional requirements:</p> <ul> <li>High availability: The system should be available 24/7.</li> <li>Fault tolerence, reliability: The system should be able to handle failure.</li> <li>Scalability: The system should be able to handle the increasing number of users. (vertical vs horizontal scaling, scalability (long-term) vs elasticity (short-term)) -&gt; not applicable in this case since the number of users is small.</li> <li>Performance: The system should be able to handle the increasing number of requests.</li> <li>Durability: The system should be able to store data for a long time.</li> <li>Consistency: The system should be able to provide consistent data to the users. (strong consistency requires all duplicates to be updated either now or later) -&gt; not applicable in this case since the data is not critically time-sensitive.</li> <li>Maintainability, security, cost, etc.</li> </ul> <p>In this case, confirm what the company wants and what users might need. Here are my current top 3 to focus on:</p> <h4 id="reliability">Reliability</h4> <ul> <li>Realibilty (High available + system is correct + system replies within certain expected time): Because you don’t want user to click on the challenge and the server is down, or incorrect, or slow.</li> </ul> <p>Do know that most server providers nowaday have high availability and fault tolerance. The only time I saw it crashed were:</p> <ul> <li> <p>When I pushed a new code to the server and it crashed during deployment -&gt; Can we serve the old version of the code while deploying the new version? Once the new version is up, can we switch to the new version without losing data? Use load balancer and server duplication for this. The cons is that it might cost more to have multiple servers.</p> </li> <li> <p>When the server was under DDoS attack -&gt; Can we protect the server from DDoS attack? Use rate limiting, shuffle sharding, cell-based architecture, etc.</p> </li> <li> <p>Unexpected failures:</p> <ul> <li>Load spike: load spike is when the server is overloaded with requests. Can we protect the server from load spike? Use load shedding, rate limiting, shuffle sharding, cell-based architecture, etc.</li> <li>Dependency failure (HTTP 424): when one action depends on another action and the other action failed. Can we protect the server from failure and performance degradation of its dependencies? Use timeouts, circuit breaker, bulkhead, retries, idempotency, etc.</li> <li>When something went wrong, can we quickly rollback to the previous version?</li> </ul> </li> </ul> <p>I also found more advanced SRE techniques from Google: https://sre.google/sre-book/addressing-cascading-failures/</p> <h4 id="security">Security</h4> <ul> <li>Security: No matter how big or small the company is, security is always a concern. The CIA triad of security is: Confidentiality, Integrity, Availability. <ul> <li>Confidentiality: Can we protect the user’s data from unauthorized access? Use encryption, access control, etc.</li> <li>Integrity: Can we protect the user’s data from unauthorized modification? authentication, authorization, etc.</li> <li>Availability: can authorized users access the system when they need it?</li> </ul> </li> </ul> <h4 id="cost">Cost</h4> <ul> <li>Cost: The company wants to keep the cost low.</li> </ul> <p>total cost = engineering cost + maintenance cost + resource cost.</p> <ul> <li>Engineering cost: the cost of developing the system, usually the cost of the engineers to design, implement, test, and deploy the system.</li> <li>Maintenance cost: Can we automate the process of deployment to reduce the cost?</li> <li>Resource cost: Hardware + software cost.</li> </ul> <h2 id="back-of-the-envelope-estimation">Back of the envelope estimation</h2> </div> </article> <div id="giscus_thread" style="max-width: 800px; margin: 0 auto;"> <script>let giscusTheme=localStorage.getItem("theme"),giscusAttributes={src:"https://giscus.app/client.js","data-repo":"chrislevn/chrislevn.github.io","data-repo-id":"","data-category":"Comments","data-category-id":"","data-mapping":"title","data-strict":"1","data-reactions-enabled":"1","data-emit-metadata":"0","data-input-position":"bottom","data-theme":giscusTheme,"data-lang":"en",crossorigin:"anonymous",async:""},giscusScript=document.createElement("script");Object.entries(giscusAttributes).forEach(([t,e])=>giscusScript.setAttribute(t,e)),document.getElementById("giscus_thread").appendChild(giscusScript);</script> <noscript>Please enable JavaScript to view the <a href="http://giscus.app/?ref_noscript" rel="external nofollow noopener" target="_blank">comments powered by giscus.</a> </noscript> </div> </div> </div> <footer class="fixed-bottom"> <div class="container mt-0"> © Copyright 2024 Christopher Loc Le. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a>. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.8/dist/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?7b30caa5023af4af8408a472dc4e1ebb"></script> <script defer src="https://unpkg.com/bootstrap-table@1.22.1/dist/bootstrap-table.min.js"></script> <script src="/assets/js/no_defer.js?d633890033921b33e0ceb13d22340a9c"></script> <script defer src="/assets/js/common.js?acdb9690d7641b2f8d40529018c71a01"></script> <script defer src="/assets/js/copy_code.js?c9d9dd48933de3831b3ee5ec9c209cac" type="text/javascript"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script async src="https://www.googletagmanager.com/gtag/js?id=G-1L7EPL0Z80"></script> <script>function gtag(){window.dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-1L7EPL0Z80");</script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>